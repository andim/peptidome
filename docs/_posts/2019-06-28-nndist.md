---
layout: post
title: Distributions of nearest neighbor distances
---

Is the finiteness of the self proteome important?

{% include image-gallery.html filter="nndist/" %}

### Code 
#### nn_analysis.ipynb



```python
import numpy as np
import pandas as pd
from scipy.stats import entropy
import scipy.stats
import seaborn as sns
import sklearn.neighbors
import matplotlib.pyplot as plt
%matplotlib inline

import Levenshtein

import sys
sys.path.append('..')

from lib import *
```


```python
df_t = load_iedb_tcellepitopes(human_only=True, positive_only=True)
```


```python
k = 9
counter9 = count_kmers_proteome(human, k, clean=True)
```


```python
human9 = set(counter9)
```


```python
# no human epitopes
mask = ~df_t['Epitope', 'Parent Species'].str.contains('Homo sapiens', na=False)
# no epitopes of unknown provenance
mask &= ~df_t['Epitope', 'Parent Species'].isna()
# only epitopes of length 9
mask &= df_t['Epitope', 'Description'].apply(len)==9
# only infectious disease epitopes
#mask &= df_t['1st in vivo Process', 'Process Type'] == 'Occurrence of infectious disease'
d = df_t[mask]
```


```python
d['1st in vivo Process', 'Process Type'].value_counts()
```




    Occurrence of infectious disease                                                   4106
    Exposure with existing immune reactivity without evidence for disease              2621
    Environmental exposure to endemic/ubiquitous agent without evidence for disease    2327
    Administration in vivo                                                              982
    No immunization                                                                     693
    Documented exposure without evidence for disease                                    207
    Exposure without evidence for disease                                               137
    Occurrence of autoimmune disease                                                     64
    Occurrence of cancer                                                                 58
    Occurrence of allergy                                                                45
    Occurrence of disease                                                                21
    Unknown                                                                              17
    Transplant/transfusion                                                               16
    Name: (1st in vivo Process, Process Type), dtype: int64




```python
d0 = d[d['Epitope', 'Description'].apply(lambda x: x in human9)]
d0
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="9" halign="left">Reference</th>
      <th>Epitope</th>
      <th>...</th>
      <th colspan="9" halign="left">Assay Antigen</th>
      <th>Assay Comments</th>
    </tr>
    <tr>
      <th></th>
      <th>Assay IRI</th>
      <th>Reference IRI</th>
      <th>Type</th>
      <th>PubMed ID</th>
      <th>Authors</th>
      <th>Journal</th>
      <th>Date</th>
      <th>Title</th>
      <th>Submission ID</th>
      <th>Epitope IRI</th>
      <th>...</th>
      <th>Non-peptidic Antigen IRI</th>
      <th>Antigen Source Molecule Name</th>
      <th>Antigen Source Molecule IRI</th>
      <th>Protein Parent Name</th>
      <th>Protein Parent IRI</th>
      <th>Antigen Organism Name</th>
      <th>Antigen Organism IRI</th>
      <th>Organism Species Name</th>
      <th>Organism Species IRI</th>
      <th>Assay Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>71222</th>
      <td>http://www.iedb.org/assay/1420885</td>
      <td>http://www.iedb.org/reference/1004613</td>
      <td>Literature</td>
      <td>12960383.0</td>
      <td>Gabriella Pietra; Chiara Romagnani; Paola Mazz...</td>
      <td>Proc Natl Acad Sci U S A</td>
      <td>2003</td>
      <td>HLA-E-restricted recognition of cytomegaloviru...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>The epitope specific CD8+ T cell clones GF2.1 ...</td>
    </tr>
    <tr>
      <th>71224</th>
      <td>http://www.iedb.org/assay/1420887</td>
      <td>http://www.iedb.org/reference/1004613</td>
      <td>Literature</td>
      <td>12960383.0</td>
      <td>Gabriella Pietra; Chiara Romagnani; Paola Mazz...</td>
      <td>Proc Natl Acad Sci U S A</td>
      <td>2003</td>
      <td>HLA-E-restricted recognition of cytomegaloviru...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>The epitope specific CD8+ T cell clone GF2.1 i...</td>
    </tr>
    <tr>
      <th>71261</th>
      <td>http://www.iedb.org/assay/1420962</td>
      <td>http://www.iedb.org/reference/1004613</td>
      <td>Literature</td>
      <td>12960383.0</td>
      <td>Gabriella Pietra; Chiara Romagnani; Paola Mazz...</td>
      <td>Proc Natl Acad Sci U S A</td>
      <td>2003</td>
      <td>HLA-E-restricted recognition of cytomegaloviru...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>79301</th>
      <td>http://www.iedb.org/assay/1472651</td>
      <td>http://www.iedb.org/reference/1006541</td>
      <td>Literature</td>
      <td>7520213.0</td>
      <td>S S Witkin; J Jeremias; M Toth; W J Ledger</td>
      <td>Am J Obstet Gynecol</td>
      <td>1994</td>
      <td>Proliferative response to conserved epitopes o...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/5394</td>
      <td>...</td>
      <td>NaN</td>
      <td>groE</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAA23128.1</td>
      <td>60 kDa chaperonin</td>
      <td>http://www.uniprot.org/uniprot/P0C0Z7</td>
      <td>Chlamydia trachomatis</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_813</td>
      <td>Chlamydia trachomatis</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_813</td>
      <td>PBMC from four of ten patients experiencing tw...</td>
    </tr>
    <tr>
      <th>108738</th>
      <td>http://www.iedb.org/assay/1645537</td>
      <td>http://www.iedb.org/reference/1014513</td>
      <td>Literature</td>
      <td>18198358.0</td>
      <td>Hubert Tsui; Yin Chan; Lan Tang; Shawn Winer; ...</td>
      <td>Diabetes</td>
      <td>2008</td>
      <td>Targeting of pancreatic glia in type 1 diabetes.</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/107000</td>
      <td>...</td>
      <td>NaN</td>
      <td>glial fibrillary acidic protein</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/EDL34160.1</td>
      <td>Glial fibrillary acidic protein</td>
      <td>http://www.uniprot.org/uniprot/P03995</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope elicited a T-cell response that was si...</td>
    </tr>
    <tr>
      <th>116420</th>
      <td>http://www.iedb.org/assay/1664514</td>
      <td>http://www.iedb.org/reference/1007092</td>
      <td>Literature</td>
      <td>1281825.0</td>
      <td>J M Davies; S Sonoda; S Yashiki; M Osame; P R ...</td>
      <td>J Neuroimmunol</td>
      <td>1992</td>
      <td>Mimicry between HTLV-I and myelin basic protei...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/113416</td>
      <td>...</td>
      <td>NaN</td>
      <td>Myelin basic protein</td>
      <td>https://ontology.iedb.org/ontology/ONTIE_0002407</td>
      <td>Myelin basic protein</td>
      <td>http://www.uniprot.org/uniprot/P25188</td>
      <td>Cavia porcellus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10141</td>
      <td>Cavia porcellus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10141</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>199545</th>
      <td>http://www.iedb.org/assay/1962919</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Using A2/epitope tetramers and CD8 antibodies,...</td>
    </tr>
    <tr>
      <th>199546</th>
      <td>http://www.iedb.org/assay/1962920</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Using A2/epitope tetramers and CD8 antibodies,...</td>
    </tr>
    <tr>
      <th>199547</th>
      <td>http://www.iedb.org/assay/1962921</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 produced IFNg in resp...</td>
    </tr>
    <tr>
      <th>199549</th>
      <td>http://www.iedb.org/assay/1962923</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 produced granzyme B i...</td>
    </tr>
    <tr>
      <th>199551</th>
      <td>http://www.iedb.org/assay/1962925</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 produced IL-2 in resp...</td>
    </tr>
    <tr>
      <th>199552</th>
      <td>http://www.iedb.org/assay/1962926</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 produced TNFa in resp...</td>
    </tr>
    <tr>
      <th>199554</th>
      <td>http://www.iedb.org/assay/1962928</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 lysed epitope-pulsed ...</td>
    </tr>
    <tr>
      <th>199555</th>
      <td>http://www.iedb.org/assay/1962929</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 lysed islet cells iso...</td>
    </tr>
    <tr>
      <th>199556</th>
      <td>http://www.iedb.org/assay/1962930</td>
      <td>http://www.iedb.org/reference/1025272</td>
      <td>Literature</td>
      <td>23155466.0</td>
      <td>Wendy W J Unger; Todd Pearson; Joana R F Abreu...</td>
      <td>PLoS One</td>
      <td>2012</td>
      <td>Islet-specific CTL cloned from a type 1 diabet...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/103705</td>
      <td>...</td>
      <td>NaN</td>
      <td>glucose-6-phosphatase, catalytic, related</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/NP_067306.1</td>
      <td>Glucose-6-phosphatase 2</td>
      <td>http://www.uniprot.org/uniprot/Q9Z186</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Mus musculus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10090</td>
      <td>Epitope-specific clone 7 demonstrated in vivo ...</td>
    </tr>
    <tr>
      <th>249449</th>
      <td>http://www.iedb.org/assay/2104092</td>
      <td>http://www.iedb.org/reference/1027586</td>
      <td>Literature</td>
      <td>24755960.0</td>
      <td>Smita K Nair; Georgia D Tomaras; Ana Paula Sal...</td>
      <td>Sci Rep</td>
      <td>2014</td>
      <td>High-throughput identification and dendritic c...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/226576</td>
      <td>...</td>
      <td>NaN</td>
      <td>Alanine and proline-rich secreted protein apa ...</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/Q50906.1</td>
      <td>Alanine and proline-rich secreted protein Apa</td>
      <td>http://www.uniprot.org/uniprot/P9WIR7</td>
      <td>Mycobacterium tuberculosis</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_1773</td>
      <td>Mycobacterium tuberculosis</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_1773</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>279349</th>
      <td>http://www.iedb.org/assay/2642070</td>
      <td>http://www.iedb.org/reference/1029824</td>
      <td>Literature</td>
      <td>26771180.0</td>
      <td>Ikbel Naouar; Thouraya Boussoffara; Mehdi Chen...</td>
      <td>PLoS One</td>
      <td>2016</td>
      <td>Prediction of T Cell Epitopes from Leishmania ...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/492663</td>
      <td>...</td>
      <td>NaN</td>
      <td>putative proteasome regulatory ATPase subunit 2</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/XP_0016818...</td>
      <td>Putative proteasome regulatory ATPase subunit 2</td>
      <td>http://www.uniprot.org/uniprot/Q4QG45</td>
      <td>Leishmania major</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_5664</td>
      <td>Leishmania major</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_5664</td>
      <td>Variable levels of GrB were detected in HLA-A*...</td>
    </tr>
    <tr>
      <th>279351</th>
      <td>http://www.iedb.org/assay/2642072</td>
      <td>http://www.iedb.org/reference/1029824</td>
      <td>Literature</td>
      <td>26771180.0</td>
      <td>Ikbel Naouar; Thouraya Boussoffara; Mehdi Chen...</td>
      <td>PLoS One</td>
      <td>2016</td>
      <td>Prediction of T Cell Epitopes from Leishmania ...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/490102</td>
      <td>...</td>
      <td>NaN</td>
      <td>putative proteasome regulatory ATPase subunit 2</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/XP_0016818...</td>
      <td>Putative proteasome regulatory ATPase subunit 2</td>
      <td>http://www.uniprot.org/uniprot/Q4QG45</td>
      <td>Leishmania major</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_5664</td>
      <td>Leishmania major</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_5664</td>
      <td>Variable levels of GrB were detected in HLA-A*...</td>
    </tr>
    <tr>
      <th>322579</th>
      <td>http://www.iedb.org/assay/3193385</td>
      <td>http://www.iedb.org/reference/1031485</td>
      <td>Literature</td>
      <td>28148797.0</td>
      <td>Alba Grifoni; Michael Angelo; John Sidney; Sin...</td>
      <td>J Virol</td>
      <td>2017</td>
      <td>Patterns of Cellular Immunity Associated with ...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/184390</td>
      <td>...</td>
      <td>NaN</td>
      <td>polyprotein</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/ANW72071.1</td>
      <td>Genome polyprotein</td>
      <td>http://www.uniprot.org/uniprot/P17763</td>
      <td>Dengue virus 4</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_11070</td>
      <td>Dengue virus</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_12637</td>
      <td>The epitope was also shown previously to be re...</td>
    </tr>
    <tr>
      <th>338722</th>
      <td>http://www.iedb.org/assay/3925457</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/95972</td>
      <td>...</td>
      <td>NaN</td>
      <td>membrane glycoprotein UL40</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>HLA-E/UL40 enriched populations from HCMV+ kid...</td>
    </tr>
    <tr>
      <th>338723</th>
      <td>http://www.iedb.org/assay/3925458</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/95972</td>
      <td>...</td>
      <td>NaN</td>
      <td>membrane glycoprotein UL40</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>CD8+ T cells from HCMV+ healthy volunteers wer...</td>
    </tr>
    <tr>
      <th>338724</th>
      <td>http://www.iedb.org/assay/3925459</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/95972</td>
      <td>...</td>
      <td>NaN</td>
      <td>membrane glycoprotein UL40</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>CD8+ T cells from HCMV+ kidney transplant reci...</td>
    </tr>
    <tr>
      <th>338726</th>
      <td>http://www.iedb.org/assay/3925463</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>HLA-E/UL40 enriched populations from HCMV+ kid...</td>
    </tr>
    <tr>
      <th>338727</th>
      <td>http://www.iedb.org/assay/3925464</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>CD8+ T cells from HCMV+ kidney transplant reci...</td>
    </tr>
    <tr>
      <th>338728</th>
      <td>http://www.iedb.org/assay/3925465</td>
      <td>http://www.iedb.org/reference/1033211</td>
      <td>Literature</td>
      <td>29709038.0</td>
      <td>Nicolas Jouand; C&amp;eacute;line Bressollette-Bod...</td>
      <td>PLoS Pathog</td>
      <td>2018</td>
      <td>HCMV triggers frequent and persistent UL40-spe...</td>
      <td>NaN</td>
      <td>http://www.iedb.org/epitope/69922</td>
      <td>...</td>
      <td>NaN</td>
      <td>UL40</td>
      <td>http://www.ncbi.nlm.nih.gov/protein/AAS48945.1</td>
      <td>Protein UL40</td>
      <td>http://www.uniprot.org/uniprot/Q6SW92</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>Human betaherpesvirus 5</td>
      <td>http://purl.obolibrary.org/obo/NCBITaxon_10359</td>
      <td>CD8+ T cells from HCMV+ healthy volunteers wer...</td>
    </tr>
  </tbody>
</table>
<p>25 rows × 141 columns</p>
</div>




```python
d0['Epitope', 'Parent Species'].unique()
```




    array(['Human betaherpesvirus 5', 'Chlamydia trachomatis', 'Mus musculus',
           'Cavia porcellus', 'Mycobacterium tuberculosis',
           'Leishmania major', 'Dengue virus'], dtype=object)




```python
counter_to_df(counter9)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>seq</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MGAPLLSPG</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>1</th>
      <td>GAPLLSPGW</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>APLLSPGWG</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PLLSPGWGA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LLSPGWGAG</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>5</th>
      <td>LSPGWGAGA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPGWGAGAA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>PGWGAGAAG</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GWGAGAAGR</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>9</th>
      <td>WGAGAAGRR</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>10</th>
      <td>GAGAAGRRW</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>11</th>
      <td>AGAAGRRWW</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>12</th>
      <td>GAAGRRWWM</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>13</th>
      <td>AAGRRWWML</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>14</th>
      <td>AGRRWWMLL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>15</th>
      <td>GRRWWMLLA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>16</th>
      <td>RRWWMLLAP</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>17</th>
      <td>RWWMLLAPL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>18</th>
      <td>WWMLLAPLL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>19</th>
      <td>WMLLAPLLP</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>20</th>
      <td>MLLAPLLPA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>21</th>
      <td>LLAPLLPAL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>22</th>
      <td>LAPLLPALL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>23</th>
      <td>APLLPALLL</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>24</th>
      <td>PLLPALLLV</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>25</th>
      <td>LLPALLLVR</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>26</th>
      <td>LPALLLVRP</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>27</th>
      <td>PALLLVRPA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>28</th>
      <td>ALLLVRPAG</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>29</th>
      <td>LLLVRPAGA</td>
      <td>1.762206e-07</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10401727</th>
      <td>NPFYTLQKP</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401728</th>
      <td>PFYTLQKPT</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401729</th>
      <td>FYTLQKPTC</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401730</th>
      <td>YTLQKPTCG</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401731</th>
      <td>TLQKPTCGY</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401732</th>
      <td>LQKPTCGYL</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401733</th>
      <td>QKPTCGYLY</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401734</th>
      <td>KPTCGYLYR</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401735</th>
      <td>PTCGYLYRR</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401736</th>
      <td>TCGYLYRRD</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401737</th>
      <td>CGYLYRRDT</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401738</th>
      <td>GYLYRRDTD</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401739</th>
      <td>YLYRRDTDH</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401740</th>
      <td>LYRRDTDHT</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401741</th>
      <td>YRRDTDHTR</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401742</th>
      <td>RRDTDHTRK</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401743</th>
      <td>RDTDHTRKR</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401744</th>
      <td>DTDHTRKRF</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401745</th>
      <td>TDHTRKRFD</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401746</th>
      <td>DHTRKRFDV</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401747</th>
      <td>HTRKRFDVP</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401748</th>
      <td>TRKRFDVPP</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401749</th>
      <td>RKRFDVPPA</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401750</th>
      <td>KRFDVPPAN</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401751</th>
      <td>RFDVPPANL</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401752</th>
      <td>FDVPPANLV</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401753</th>
      <td>DVPPANLVL</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401754</th>
      <td>VPPANLVLW</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401755</th>
      <td>PPANLVLWR</td>
      <td>8.811031e-08</td>
    </tr>
    <tr>
      <th>10401756</th>
      <td>PANLVLWRS</td>
      <td>8.811031e-08</td>
    </tr>
  </tbody>
</table>
<p>10401757 rows × 2 columns</p>
</div>




```python
p = len(human9)/20**9
d0.shape[0], p*d.shape[0]
```




    (25, 0.2294887638125)




```python
def dist1(x):
    for i in range(len(x)):
        for aa in aminoacids:
            if aa == x[i]:
                continue
            if x[:i]+aa+x[i+1:] in human9:
                return True
    return False
d1 = d[d['Epitope', 'Description'].apply(dist1)]
```


```python
d1.shape[0], p*d.shape[0]*19*9
```




    (269, 39.242578611937496)




```python
d1['Epitope', 'Parent Species'].unique()
```




    array(['Hepatitis B virus', 'Mycobacterium tuberculosis',
           'Influenza A virus', 'Dengue virus', 'Borreliella burgdorferi',
           'Hepacivirus C', 'Streptococcus pyogenes', 'Plasmodium falciparum',
           'Plasmodium vivax', 'Leishmania donovani', 'Trypanosoma cruzi',
           'Human gammaherpesvirus 4', 'Chlamydia trachomatis',
           'Human betaherpesvirus 5', 'Measles morbillivirus',
           'Severe acute respiratory syndrome-related coronavirus',
           'Vaccinia virus', 'Triticum aestivum', 'Human metapneumovirus',
           'Primate T-lymphotropic virus 1', 'Mus musculus',
           'Mycobacterium kansasii', 'Toxoplasma gondii',
           'Human alphaherpesvirus 1', 'Alphapapillomavirus 9',
           'Mycobacterium leprae', 'Leishmania major',
           'Human mastadenovirus C', 'Bacteroides stercoris'], dtype=object)



# Hamming distance calculation


```python
humansample = random.sample(human9, 100000)
points = np.asarray([map_aatonumber(h) for h in humansample])

```


```python
#def hamming(s1, s2):
#    return sum(c1==c2 for c1, c2 in zip(s1, s2))
def mindist(x, sample):
    return min(Levenshtein.hamming(s, x) for s in sample)
```


```python
mindist('AAACCCAAA', humansample)
```




    3




```python
%timeit -t mindist('AAACCCAAA', humansample)
```

    38.8 ms ± 4.83 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)



```python
bt = sklearn.neighbors.BallTree(points, metric='hamming')
```


```python
def mindist_sklearn(x, tree):
    d, i = tree.query(map_aatonumber(x).reshape(1, -1))
    return int(d*len(x))
```


```python
mindist_sklearn('AAACCCAAA', bt)
```




    3




```python
%timeit -t mindist_sklearn('AAACCCAAA', bt)
```

    5.82 ms ± 643 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)


## on all 9mers


```python
mindist('AAACCCAAA', human9)
```




    2




```python
%timeit -t mindist('AAACCCAAA', human9)
```

    4.06 s ± 213 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)



```python
human9_number = np.asarray([map_aatonumber(h) for h in human9])
```


```python
pointss = np.array_split(human9_number, 100)
```


```python
bts = [sklearn.neighbors.BallTree(points, metric='hamming') for points in pointss]
```


```python
def mindist_sklearn_chunked(x, trees):
    d = min(bt.query(map_aatonumber(x).reshape(1, -1))[0] for bt in trees)
    return int(d*len(x))
```


```python
mindist_sklearn_chunked('AAACCCAAA', bts)
```




    2




```python
%timeit -t mindist_sklearn_chunked('AAACCCAAA', bts)
```

    609 ms ± 9.66 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)


# Analysis of flu epitopes


```python
# no human epitopes
mask = ~df_t['Epitope', 'Parent Species'].str.contains('Homo sapiens', na=False)
# no epitopes of unknown provenance
mask &= ~df_t['Epitope', 'Parent Species'].isna()
# only epitopes of length 9
mask &= df_t['Epitope', 'Description'].apply(len)==9
d = df_t[mask]
```


```python
d['Epitope', 'Parent Species'].value_counts()
```




    Human gammaherpesvirus 4                                 1858
    Human betaherpesvirus 5                                  1452
    Hepacivirus C                                            1438
    Influenza A virus                                         984
    Mycobacterium tuberculosis                                725
    Dengue virus                                              722
    Primate T-lymphotropic virus 1                            482
    Hepatitis B virus                                         364
    Vaccinia virus                                            345
    Human immunodeficiency virus 1                            336
    Human alphaherpesvirus 1                                  243
    Alphapapillomavirus 9                                     148
    Plasmodium falciparum                                     140
    Trypanosoma cruzi                                         140
    Mycobacterium leprae                                      129
    Yellow fever virus                                        119
    Human gammaherpesvirus 8                                   98
    Toxoplasma gondii                                          96
    Human betaherpesvirus 6B                                   94
    Human polyomavirus 1                                       90
    West Nile virus                                            89
    Adeno-associated dependoparvovirus A                       83
    Human mastadenovirus C                                     77
    Human alphaherpesvirus 2                                   77
    Leishmania donovani                                        69
    Human polyomavirus 2                                       60
    Severe acute respiratory syndrome-related coronavirus      56
    Human orthopneumovirus                                     52
    Measles morbillivirus                                      49
    Chlamydia trachomatis                                      42
                                                             ... 
    Gallid alphaherpesvirus 2                                   1
    Streptomyces phage mu1/6                                    1
    Mycolicibacterium gilvum                                    1
    Klebsiella phage phiKO2                                     1
    Anisakis simplex                                            1
    Spodoptera litura nucleopolyhedrovirus                      1
    Prochlorococcus phage P-HM1                                 1
    Herpesviridae                                               1
    Aquareovirus C                                              1
    Eastern equine encephalitis virus                           1
    Escherichia virus IME08                                     1
    Cryptomeria japonica                                        1
    Chlamydia pneumoniae                                        1
    Ricinus communis                                            1
    Spodoptera frugiperda ascovirus 1a                          1
    Mycobacterium ulcerans                                      1
    Crimean-Congo hemorrhagic fever orthonairovirus             1
    Cavia porcellus                                             1
    Mycobacterium virus Predator                                1
    Enterobacteria phage VT2-Sakai                              1
    Enterovirus C                                               1
    Canis lupus                                                 1
    Escherichia virus RB43                                      1
    Mupapillomavirus 1                                          1
    Panine betaherpesvirus 2                                    1
    Spodoptera litura nucleopolyhedrovirus II                   1
    Bacillus pumilus                                            1
    Rhodococcus hoagii                                          1
    Guanarito mammarenavirus                                    1
    Ebolavirus                                                  1
    Name: (Epitope, Parent Species), Length: 118, dtype: int64




```python
fluepis = d[d['Epitope', 'Parent Species'] == 'Influenza A virus']['Epitope', 'Description'].unique()
fluepis.shape
```




    (114,)




```python
plt.hist([len(s) for s in fluepis], bins=np.arange(8, 21))
```




    (array([  0., 114.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,
              0.]),
     array([ 8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]),
     <a list of 12 Patch objects>)




![png](notebook_files/nn_analysis_35_1.png)



```python
fludists = [mindist_sklearn_chunked(e, bts) for e in fluepis]
```


```python
proteomes = load_proteomes()

```


```python
df_flua = counter_to_df(count_kmers_proteome(datadir + proteomes.loc['InfluenzaA']['path'], 9), norm=True)
df_flua.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>seq</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MDSNTMSSF</td>
      <td>0.000627</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DSNTMSSFQ</td>
      <td>0.000627</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SNTMSSFQV</td>
      <td>0.000313</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NTMSSFQVD</td>
      <td>0.000313</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TMSSFQVDC</td>
      <td>0.000313</td>
    </tr>
  </tbody>
</table>
</div>




```python
distss = []
for i in range(3):
    peptides = np.random.choice(df_flua['seq'], size=len(fludists), replace=False, p=df_flua['freq'])
    dists = [mindist_sklearn_chunked(e, bts) for e in peptides]
    distss.append(dists)
```


```python
counts = np.bincount(fludists)
print(counts)
plt.plot(counts, 'o')
for d in [distss[0], distss[1], distss[2]]:
    counts = np.bincount(d)
    print(counts)
    plt.plot(counts, 'kx')
```

    [ 0  2 53 58  1]
    [ 0  1 50 63]
    [ 0  0 52 61  1]
    [ 0  0 46 67  1]



![png](notebook_files/nn_analysis_40_1.png)



```python
def dist2(x):
    for i in range(len(x)):
        for j in range(i+1, len(x)):
            for aai in aminoacids:
                si = x[:i]+aai+x[i+1:]
                for aaj in aminoacids:
                    if (aai == x[i]) and (aaj == x[j]):
                        continue
                    if si[:j]+aaj+si[j+1:] in human9:
                        return True
    return False
```


```python
def dists_direct(df, ref):
    d0 = df[df['seq'].apply(lambda x: x in ref)].shape[0]/df['seq'].shape[0]
    d1 = df[df['seq'].apply(dist1)].shape[0]/df['seq'].shape[0]
    d2 = df[df['seq'].apply(dist2)].shape[0]/df['seq'].shape[0]
    return d0, d1, d2
```


```python
distsallflu = dists_direct(df_flua, human9)
```


```python
counts = np.bincount(fludists)
plt.plot(counts/np.sum(counts), 'o')
plt.plot(distsallflu, 'x')

N = sum(counter9.values())
print('%e'%N)
k = 9
K = 20**k

dists = np.arange(6)
Nc = lambda d: 19**dists * falling_factorial(k, dists+1)
cumulative = [0]
cumulative.extend(1-np.exp(-Nc(dists)*N/K))
plt.plot(dists, np.diff(cumulative), '+')
plt.ylim(0.0)
```

    1.134941e+07





    (0.0, 0.5901551987989777)




![png](notebook_files/nn_analysis_44_2.png)



```python
hivepis = d[d['Epitope', 'Parent Species'] == 'Human immunodeficiency virus 1']['Epitope', 'Description'].unique()
hivepis.shape
```


    ---------------------------------------------------------------------------

    TypeError                                 Traceback (most recent call last)

    <ipython-input-43-a17f59b3d4c6> in <module>
    ----> 1 hivepis = d[d['Epitope', 'Parent Species'] == 'Human immunodeficiency virus 1']['Epitope', 'Description'].unique()
          2 hivepis.shape


    TypeError: list indices must be integers or slices, not tuple



```python
hivdists = [mindist_sklearn_chunked(e, bts) for e in hivepis]
```


```python
counts = np.bincount(hivdists)
print(counts)
plt.plot(counts, 'x')
```


```python
df_hiv1 = counter_to_df(count_kmers_proteome(datadir + proteomes.loc['HIV']['path'], 9), norm=True)
df_hiv1.head()
```


```python
distss_hiv = []
for i in range(3):
    peptides = np.random.choice(df_hiv1['seq'], size=len(hivdists), replace=False, p=df_hiv1['freq'])
    dists = [mindist_sklearn_chunked(e, bts) for e in peptides]
    distss_hiv.append(dists)
```


```python
counts = np.bincount(hivdists)
print(counts)
plt.plot(counts, 'o')
for d in distss_hiv:
    counts = np.bincount(d)
    print(counts)
    plt.plot(counts, 'kx')
```


```python
distsallhiv = dists_direct(df_hiv1, human9)
```


```python
counts = np.bincount(hivdists)
plt.plot(counts/np.sum(counts), 'o')
plt.plot(distsallhiv, 'x')
N = sum(counter9.values())
print('%e'%N)
k = 9
K = 20**k

dists = np.arange(6)
Nc = lambda d: 19**dists * falling_factorial(k, dists+1)
cumulative = [0]
cumulative.extend(1-np.exp(-Nc(dists)*N/K))
plt.plot(dists, np.diff(cumulative), '+')
plt.ylim(0.0)
```


```python

```
#### math.ipynb



```python
import numpy as np
import pandas as pd
from scipy.stats import entropy
import scipy.stats
import seaborn as sns
import sklearn.neighbors
import matplotlib.pyplot as plt
%matplotlib inline

import Levenshtein

import sys
sys.path.append('..')

from lib import *
```


```python
N = 1e7
k = 9
K = 20**k
```


```python
d = np.arange(6)
fig, ax = plt.subplots()
Nc = lambda d: 19**d * falling_factorial(k, d+1)
Ncs = Nc(d)
cumulative = [0]
cumulative.extend(1-np.exp(-np.cumsum(Ncs)*N/K))
ax.plot(d, np.diff(cumulative), 'o')
ax.set_ylim(0, 1)
```




    (0, 1)




![png](notebook_files/math_2_1.png)



```python

```
