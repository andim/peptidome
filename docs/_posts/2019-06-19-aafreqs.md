---
layout: post
title: Amino acid frequencies
---

Various analyses based on amino acid frequencies.


{% include post-image-gallery.html filter="aafreqs/" %}

### Code 
#### geneticbias.ipynb



```python
import sys
sys.path.append('..')
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import projgrad
plt.style.use('../peptidome.mplstyle')

from lib import *
```


```python
codon_map = {"UUU":"F", "UUC":"F", "UUA":"L", "UUG":"L",
    "UCU":"S", "UCC":"S", "UCA":"S", "UCG":"S",
    "UAU":"Y", "UAC":"Y", "UAA":"STOP", "UAG":"STOP",
    "UGU":"C", "UGC":"C", "UGA":"STOP", "UGG":"W",
    "CUU":"L", "CUC":"L", "CUA":"L", "CUG":"L",
    "CCU":"P", "CCC":"P", "CCA":"P", "CCG":"P",
    "CAU":"H", "CAC":"H", "CAA":"Q", "CAG":"Q",
    "CGU":"R", "CGC":"R", "CGA":"R", "CGG":"R",
    "AUU":"I", "AUC":"I", "AUA":"I", "AUG":"M",
    "ACU":"T", "ACC":"T", "ACA":"T", "ACG":"T",
    "AAU":"N", "AAC":"N", "AAA":"K", "AAG":"K",
    "AGU":"S", "AGC":"S", "AGA":"R", "AGG":"R",
    "GUU":"V", "GUC":"V", "GUA":"V", "GUG":"V",
    "GCU":"A", "GCC":"A", "GCA":"A", "GCG":"A",
    "GAU":"D", "GAC":"D", "GAA":"E", "GAG":"E",
    "GGU":"G", "GGC":"G", "GGA":"G", "GGG":"G",}
```


```python
fluA = datadir + proteomes.loc['InfluenzaA']['path']
df = counter_to_df(count_kmers_proteome(human, 1), norm=True)
df = df.set_index('seq')
df = df.sort_index()
```


```python
nt_to_ind = {
    'A' : 0,
    'C' : 1,
    'G' : 2,
    'U' : 3 
    }
def calc_frequencies(p):
    frequencies = {aa:0 for aa in df.index}
    for nts, aa in codon_map.items():
        if not aa == 'STOP':
            frequencies[aa] += np.prod([p[nt_to_ind[nt]] for nt in nts])
    return frequencies
```


```python
p = [0.27, 0.23, 0.23, 0.27]
#p = np.ones(4)
p /= np.sum(p)
print(np.sum(p))
frequencies = calc_frequencies(p)
df_theory = pd.DataFrame.from_dict(frequencies, orient='index', columns=['freq_theory'])
dfm = df.merge(df_theory, left_index=True, right_index=True)
dfm.plot(kind='bar')

calc_jsd(dfm['freq'], dfm['freq_theory'])
```

    1.0





    0.01109111327904973




![png](notebook_files/geneticbias_4_2.png)



```python
def fun(p, epsilon = 1e-8):
    def f(p):
        frequencies = calc_frequencies(p)
        df_theory = pd.DataFrame.from_dict(frequencies, orient='index', columns=['freq_theory'])
        dfm = df.merge(df_theory, left_index=True, right_index=True)
        return calc_jsd(dfm['freq'], dfm['freq_theory'])
    return f(p), scipy.optimize.approx_fprime(p, f, epsilon)
res = projgrad.minimize(fun, np.ones(4)/4.0)
res
```




           x: array([0.29563726, 0.21821714, 0.2498734 , 0.23627219])
         fun: 0.008641217018279268
         nit: 100
     success: True




```python
frequencies = calc_frequencies(res.x)
df_theory = pd.DataFrame.from_dict(frequencies, orient='index', columns=['freq_theory'])
dfm = df.merge(df_theory, left_index=True, right_index=True)
dfm.plot(kind='scatter', x='freq_theory', y='freq')
```




    <matplotlib.axes._subplots.AxesSubplot at 0x7f507d8572b0>




![png](notebook_files/geneticbias_6_1.png)



```python

```
#### plot-aafreqs.py

```python
import sys
sys.path.append('..')
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
plt.style.use('../peptidome.mplstyle')

from lib import *

df = counter_to_df(count_kmers_proteome(human, 1), norm=True)
df = df.set_index('seq')
df = df.sort_index()

fig, ax = plt.subplots()
df.plot(kind='bar', ax=ax, legend=False)
ax.set_xlabel('amino acid')
ax.set_ylabel('frequency')
fig.tight_layout()
plt.show()
fig.savefig('main.png')

```
#### bokehplot.py

```python
import numpy as np
import pandas as pd

from bokeh.plotting import figure, show, output_file

df = pd.read_csv('data.csv', index_col=0)
df['fold'] = df['freq_pathogen']/df['freq_human']

#df = df[df['fold']>10.0]

df['freq_human'] = np.log10(df['freq_human'])
df['freq_pathogen'] = np.log10(df['freq_pathogen'])

TOOLS="hover,crosshair,pan,wheel_zoom,zoom_in,zoom_out,box_zoom,undo,redo,reset,tap,save,box_select,poly_select,lasso_select,"

TOOLTIPS = [
    ("(f_human, f_pathogen)", "($x, $y)"),
    ("peptide", "@seq"),
]

p = figure(tools=TOOLS, tooltips=TOOLTIPS)

p.scatter('freq_human', 'freq_pathogen', source=df, radius=0.02,
          fill_alpha=0.6,
          line_color=None)

output_file("color_scatter.html", title="color_scatter.py example")

show(p)  # open a browser


```
